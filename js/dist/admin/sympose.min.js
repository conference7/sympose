"use strict";function addRow(e,t,s){var a=jQuery('tr[data-type="initial"]',e),n=jQuery("tr:last-child",a.closest("tbody")).attr("data-id");"initial"===n&&(n=0);var r=parseInt(n)+1,i=a.clone().attr("data-type",t).attr("data-id",r);jQuery("input, select",i).map((function(e,t){jQuery(t).attr("name",jQuery(t).attr("name").replace("row",r))})),i.appendTo(a.closest("tbody")),!0===s&&jQuery("td:first-child input",i).focus()}function refreshPage(e){var t=new URL(window.location.href);e?(t.searchParams.set("step",e),window.history.pushState({},document.title,t)):e=t.searchParams.get("step"),e&&jQuery("form#sympose-quick-start").attr("data-id",e),updateSchedule(),jQuery("form#sympose-quick-start .block[data-id="+e+"] input:visible").first().focus()}function updateSchedule(){var e,t=jQuery("form#sympose-quick-start input#days"),s=jQuery("form#sympose-quick-start table.schedule[data-type=initial]"),a=t.val();for(0!==a&&a&&void 0!==a||(a=1),e=1;e<=a;e++){if(jQuery("form#sympose-quick-start table.schedule[data-id="+e+"]").length<1){var n=s.clone();n.attr("data-type","clone"),n.attr("data-id",e),jQuery(".title",n).text(jQuery(".title",n).text()+" "+e),jQuery("input, select",n).map((function(t,s){jQuery(s).attr("name",jQuery(s).attr("name").replace("initial",e))})),n.appendTo(s.parent())}}jQuery("form#sympose-quick-start .content .block[data-id=4] select").map((function(e,t){var s=jQuery('tr:not([data-type=initial]) input[name="'+t.dataset.type+'[]"]'),a="";jQuery("option:first-child",t).map((function(e,t){a+='<option value="0">'+t.textContent+"</option>"})),s.map((function(e,t){e++;var s=jQuery(t).val();s&&(a+='<option value="'+e+'">'+s+"</option>")})),jQuery(t).html(a);var n=JSON.parse(t.dataset.selected);n.length>0&&jQuery(t).val(n)}))}document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector('a[data-action="sympose-start-migration"]');null!==e&&e.addEventListener("click",(function(){e.nextElementSibling.classList.add("is-active"),e.setAttribute("disabled",!0);var t=wpApiSettings.root+"sympose/v1/migrate",s={"X-WP-Nonce":wpApiSettings.nonce};fetch(t,{method:"POST",headers:s,body:JSON.stringify({version:e.dataset.version})}).then((function(e){return e.json()})).then((function(t){200===t.status&&(e.nextElementSibling.classList.remove("is-active"),e.setAttribute("disabled",!1),e.innerHTML="Done!")}))}))})),jQuery(document).ready((function(e){refreshPage();var t=e("form#sympose-quick-start");e("form#sympose-quick-start .steps li a").on("click",(function(t){t.preventDefault(),window.history.pushState({},document.title,e(this).attr("href")),refreshPage()})),e("form#sympose-quick-start .footer li").on("click","a",(function(s){s.preventDefault();var a=e("form#sympose-quick-start").attr("data-id");if("next"==e(s.target).parent().data("action"))refreshPage(parseInt(a)+1);else if("prev"==e(s.target).parent().data("action"))a>1&&refreshPage(parseInt(a)-1);else if("submit"==e(s.target).parent().data("action")){var n=new FormData(document.querySelector("form#sympose-quick-start"));e.ajax({url:wpApiSettings.root+"sympose/v1/quick_start_event",method:"POST",processData:!1,contentType:!1,beforeSend:function(t){e("form#sympose-quick-start .spinner").addClass("is-active"),t.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},data:n,success:function(s){e("form#sympose-quick-start .spinner").removeClass("is-active"),e(".notice",t.parent()).remove(),400===s.status?t.parent().prepend('<div class="notice notice-error is-dismissible"> <p>'+s.message+"</p> </div>"):(t.parent().prepend('<div class="notice notice-success is-dismissible"> <p>'+s.message+"</p> </div>"),e("form#sympose-quick-start table tr[data-type=clone], form#sympose-quick-start table tr[data-type=first]").remove(),e("form#sympose-quick-start .content .block table").map((function(t,s){e("tr[data-type=first]",this).length<1&&addRow(s,"first",!1)})),e("form#sympose-quick-start input").val("")),e(".sympose-setup-wizard > .content").animate({scrollTop:0},400,"swing")},error:function(){}})}})),e("form#sympose-quick-start .content .block table").map((function(t,s){e("tr[data-type=first]",this).length<1&&addRow(s,"first",!1)})),e("form#sympose-quick-start .content").on("click",'.block table a[data-action="add"]',(function(t){t.preventDefault(),addRow(e(this).closest("table"),"clone",!0)})),e("form#sympose-quick-start").on("keyup",(function(t){e(t.target).parents("tr").is(":last-child")&&"9"==t.which&&e(t.target).parents("td").is(":last-child")&&(t.shiftKey||addRow(e(t.target).closest("table"),"clone",!0))})),e("form#sympose-quick-start .content .block table").on("click",'a[data-action="delete"]',(function(t){t.preventDefault(),e(this).closest("tr").remove();var s=new FormData(document.querySelector("form#sympose-quick-start"));s.append("save_data","yes"),e.ajax({url:wpApiSettings.root+"sympose/v1/quick_start_event",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},method:"POST",processData:!1,contentType:!1,data:s,success:function(e){}})})),e("form#sympose-quick-start").on("change",(function(t){var s=new FormData(document.querySelector("form#sympose-quick-start"));s.append("save_data","yes"),e.ajax({url:wpApiSettings.root+"sympose/v1/quick_start_event",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},method:"POST",processData:!1,contentType:!1,data:s,success:function(e){}})}))})),document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector(".sympose-setup-wizard");if(null!==e){resizeSetupWizard(),e.style.display="flex";var t=e.querySelectorAll("ul.buttons li a"),s=e.querySelector(".sympose-setup-wizard-notices");t.forEach((function(t){t.addEventListener("click",(function(a){a.preventDefault();var n=a.target.dataset.action,r={"X-WP-Nonce":wpApiSettings.nonce},i="",o="";"setup-sample-data"===n&&(t.parentNode.querySelector(".spinner").style.display="block",t.parentNode.querySelector(".spinner").classList.add("is-active"),i=wpApiSettings.root+"sympose/v1/generate_sample_data"),"skip-step"===n&&(i=wpApiSettings.root+"sympose/v1/quick_start_event",o={action:n},e.style.display="none"),"quick-start"===n&&(e.querySelector(".wizard-content[data-type=quick-start]").style.display="block",e.querySelector(".wizard-content[data-type=introduction]").style.display="none"),fetch(i,{method:"POST",headers:r,body:JSON.stringify(o)}).then((function(e){return e.json()})).then((function(e){200===e.status&&(null!==t.parentNode.querySelector(".spinner")&&(t.parentNode.querySelector(".spinner").classList.remove("is-active"),t.parentNode.querySelector(".spinner").style.display="none"),s.innerHTML='<div class="notice notice-success is-dismissible"> <p>'+e.message+"</p> </div>")}))}))})),new URL(window.location.href).searchParams.get("step")&&(e.querySelector(".wizard-content[data-type=quick-start]").style.display="block",e.querySelector(".wizard-content[data-type=introduction]").style.display="none")}}));var resizeSetupWizard=function(){var e=document.querySelector(".sympose-setup-wizard"),t=document.querySelector("#wpcontent");null!==e&&(e.style.marginLeft=t.offsetLeft+"px")};window.addEventListener("resize",resizeSetupWizard),function(e){e((function(){e(".sympose-generate-sample-data").on("click","input[type=submit]",(function(t){t.preventDefault();var s=e(this).siblings("span.spinner");e.ajax({url:wpApiSettings.root+"sympose/v1/generate_sample_data",method:"GET",beforeSend:function(e){s.addClass("is-active"),e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}}).done((function(t){400==t.status?e(".wrap h2").after('<div class="notice notice-error is-dismissible"> <p>'+t.message+"</p> </div>"):e(".wrap h2").after('<div class="notice notice-success is-dismissible"> <p>'+t.message+"</p> </div>"),s.removeClass("is-active"),e(this).attr("disabled","disabled")}))}));var t=e(".cmb-row.sortable");t.length>0&&e("ul.cmb2-list",t).sortable({update:function(t,s){var a=e(this).sortable("toArray").join();e(this).prev().val(a)}})}))}(jQuery);