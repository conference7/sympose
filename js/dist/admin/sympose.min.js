"use strict";function addRow(e,t,a){var s=jQuery('tr[data-type="initial"]',e),r=jQuery("tr:last-child",s.closest("tbody")).attr("data-id");"initial"===r&&(r=0);var n=parseInt(r)+1,o=s.clone().attr("data-type",t).attr("data-id",n);jQuery("input, select",o).map((function(e,t){jQuery(t).attr("name",jQuery(t).attr("name").replace("row",n))})),o.appendTo(s.closest("tbody")),!0===a&&jQuery("td:first-child input",o).focus()}function refreshPage(e){var t=new URL(window.location.href);e?(t.searchParams.set("step",e),window.history.pushState({},document.title,t)):e=t.searchParams.get("step"),e&&jQuery("form#sympose-quick-start").attr("data-id",e),updateSchedule(),jQuery("form#sympose-quick-start .block[data-id="+e+"] input:visible").first().focus()}function updateSchedule(){var e,t=jQuery("form#sympose-quick-start input#days"),a=jQuery("form#sympose-quick-start table.schedule[data-type=initial]"),s=t.val();for(0!==s&&s&&void 0!==s||(s=1),e=1;e<=s;e++){if(jQuery("form#sympose-quick-start table.schedule[data-id="+e+"]").length<1){var r=a.clone();r.attr("data-type","clone"),r.attr("data-id",e),jQuery(".title",r).text(jQuery(".title",r).text()+" "+e),jQuery("input, select",r).map((function(t,a){jQuery(a).attr("name",jQuery(a).attr("name").replace("initial",e))})),r.appendTo(a.parent())}}jQuery("form#sympose-quick-start .content .block[data-id=4] select").map((function(e,t){var a=jQuery('tr:not([data-type=initial]) input[name="'+t.dataset.type+'[]"]'),s="";jQuery("option:first-child",t).map((function(e,t){s+='<option value="0">'+t.textContent+"</option>"})),a.map((function(e,t){e++;var a=jQuery(t).val();a&&(s+='<option value="'+e+'">'+a+"</option>")})),jQuery(t).html(s);var r=JSON.parse(t.dataset.selected);r.length>0&&jQuery(t).val(r)}))}jQuery(document).ready((function(e){refreshPage();var t=e("form#sympose-quick-start");e("form#sympose-quick-start .steps li a").on("click",(function(t){t.preventDefault(),window.history.pushState({},document.title,e(this).attr("href")),refreshPage()})),e("form#sympose-quick-start .footer li").on("click","a",(function(a){a.preventDefault();var s=e("form#sympose-quick-start").attr("data-id");if("next"==e(a.target).parent().data("action"))refreshPage(parseInt(s)+1);else if("prev"==e(a.target).parent().data("action"))s>1&&refreshPage(parseInt(s)-1);else if("submit"==e(a.target).parent().data("action")){var r=new FormData(document.querySelector("form#sympose-quick-start"));e.ajax({url:wpApiSettings.root+"sympose/v1/quick_start_event",method:"POST",processData:!1,contentType:!1,beforeSend:function(t){e("form#sympose-quick-start .spinner").addClass("is-active"),t.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},data:r,success:function(a){e("form#sympose-quick-start .spinner").removeClass("is-active"),e(".notice",t.parent()).remove(),400===a.status?t.parent().prepend('<div class="notice notice-error is-dismissible"> <p>'+a.message+"</p> </div>"):(t.parent().prepend('<div class="notice notice-success is-dismissible"> <p>'+a.message+"</p> </div>"),e("form#sympose-quick-start table tr[data-type=clone], form#sympose-quick-start table tr[data-type=first]").remove(),e("form#sympose-quick-start .content .block table").map((function(t,a){e("tr[data-type=first]",this).length<1&&addRow(a,"first",!1)})),e("form#sympose-quick-start input").val("")),e(".sympose-setup-wizard > .content").animate({scrollTop:0},400,"swing")},error:function(){}})}})),e("form#sympose-quick-start .content .block table").map((function(t,a){e("tr[data-type=first]",this).length<1&&addRow(a,"first",!1)})),e("form#sympose-quick-start .content").on("click",'.block table a[data-action="add"]',(function(t){t.preventDefault(),addRow(e(this).closest("table"),"clone",!0)})),e("form#sympose-quick-start").on("keyup",(function(t){e(t.target).parents("tr").is(":last-child")&&"9"==t.which&&e(t.target).parents("td").is(":last-child")&&(t.shiftKey||addRow(e(t.target).closest("table"),"clone",!0))})),e("form#sympose-quick-start .content .block table").on("click",'a[data-action="delete"]',(function(t){t.preventDefault(),e(this).closest("tr").remove();var a=new FormData(document.querySelector("form#sympose-quick-start"));a.append("save_data","yes"),e.ajax({url:wpApiSettings.root+"sympose/v1/quick_start_event",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},method:"POST",processData:!1,contentType:!1,data:a,success:function(e){console.log(e)}})})),e("form#sympose-quick-start").on("change",(function(t){var a=new FormData(document.querySelector("form#sympose-quick-start"));a.append("save_data","yes"),e.ajax({url:wpApiSettings.root+"sympose/v1/quick_start_event",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)},method:"POST",processData:!1,contentType:!1,data:a,success:function(e){}})}))})),document.addEventListener("DOMContentLoaded",(function(){var e=document.querySelector(".sympose-setup-wizard");if(null!==e){resizeSetupWizard(),e.style.display="flex";var t=e.querySelectorAll("ul.buttons li a"),a=e.querySelector(".sympose-setup-wizard-notices");t.forEach((function(t){t.addEventListener("click",(function(s){s.preventDefault();var r=s.target.dataset.action,n={"X-WP-Nonce":wpApiSettings.nonce},o="",i="";"setup-sample-data"===r&&(t.parentNode.querySelector(".spinner").style.display="block",t.parentNode.querySelector(".spinner").classList.add("is-active"),o=wpApiSettings.root+"sympose/v1/generate_sample_data"),"skip-step"===r&&(o=wpApiSettings.root+"sympose/v1/quick_start_event",i={action:r},e.style.display="none"),"quick-start"===r&&(e.querySelector(".wizard-content[data-type=quick-start]").style.display="block",e.querySelector(".wizard-content[data-type=introduction]").style.display="none"),fetch(o,{method:"POST",headers:n,body:JSON.stringify(i)}).then((function(e){return e.json()})).then((function(e){200===e.status&&(null!==t.parentNode.querySelector(".spinner")&&(t.parentNode.querySelector(".spinner").classList.remove("is-active"),t.parentNode.querySelector(".spinner").style.display="none"),a.innerHTML='<div class="notice notice-success is-dismissible"> <p>'+e.message+"</p> </div>")}))}))})),new URL(window.location.href).searchParams.get("step")&&(e.querySelector(".wizard-content[data-type=quick-start]").style.display="block",e.querySelector(".wizard-content[data-type=introduction]").style.display="none")}}));var resizeSetupWizard=function(){var e=document.querySelector(".sympose-setup-wizard"),t=document.querySelector("#wpcontent");null!==e&&(e.style.marginLeft=t.offsetLeft+"px")};window.addEventListener("resize",resizeSetupWizard),function(e){e((function(){e(".sympose-generate-sample-data").on("click","input[type=submit]",(function(t){t.preventDefault();var a=e(this).siblings("span.spinner");e.ajax({url:wpApiSettings.root+"sympose/v1/generate_sample_data",method:"GET",beforeSend:function(e){a.addClass("is-active"),e.setRequestHeader("X-WP-Nonce",wpApiSettings.nonce)}}).done((function(t){400==t.status?e(".wrap h2").after('<div class="notice notice-error is-dismissible"> <p>'+t.message+"</p> </div>"):e(".wrap h2").after('<div class="notice notice-success is-dismissible"> <p>'+t.message+"</p> </div>"),a.removeClass("is-active"),e(this).attr("disabled","disabled")}))}));var t=e(".cmb-row.sortable");t.length>0&&e("ul.cmb2-list",t).sortable()}))}(jQuery);